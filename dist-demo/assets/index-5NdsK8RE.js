(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();const l="prototype-comments";function i(){return typeof window<"u"&&typeof document<"u"}function m(){let n=[];return{load:()=>[...n],save:e=>{n=[...e]},clear:()=>{n=[]}}}function y(){return{load:()=>{if(!i()||!("localStorage"in window))return[];try{const n=window.localStorage.getItem(l);if(!n)return[];const e=JSON.parse(n);return Array.isArray(e)?e:[]}catch{return[]}},save:n=>{if(!(!i()||!("localStorage"in window)))try{window.localStorage.setItem(l,JSON.stringify(n))}catch{}},clear:()=>{if(!(!i()||!("localStorage"in window)))try{window.localStorage.removeItem(l)}catch{}}}}class u{isEnabled=!1;storage=m();comments=[];overlayElement=null;exportAs="json";enable(e={}){if(!i()){this.storage=m(),this.comments=[],this.exportAs=e.exportFormat??"json",this.isEnabled=!0;return}this.exportAs=e.exportFormat??"json";const t=e.storage??"memory";this.storage=t==="localStorage"?y():m(),this.comments=this.storage.load(),this.ensureOverlay(),this.renderOverlay(),this.isEnabled=!0}disable(){this.isEnabled&&(this.teardownOverlay(),this.isEnabled=!1)}export(){return this.exportAs==="markdown"?this.toMarkdown(this.comments):this.toJson(this.comments)}getAll(){return[...this.comments]}addComment(e){const t={id:e.id??Math.random().toString(36).slice(2),text:e.text,x:e.x,y:e.y,timestamp:e.timestamp??Date.now()};return this.comments.push(t),this.persist(),this.renderOverlay(),t}clear(){this.comments=[],this.persist(),this.renderOverlay()}persist(){this.storage.save(this.comments)}ensureOverlay(){if(!i()||this.overlayElement)return;const e=document.createElement("div");e.setAttribute("data-prototype-comments-overlay",""),e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.pointerEvents="none",e.style.zIndex="2147483647",e.style.fontFamily="system-ui, -apple-system, Segoe UI, Roboto, sans-serif",document.body.appendChild(e),this.overlayElement=e}teardownOverlay(){if(!this.overlayElement)return;const e=this.overlayElement.parentElement;e&&e.removeChild(this.overlayElement),this.overlayElement=null}renderOverlay(){if(!this.overlayElement)return;const e=this.overlayElement;e.innerHTML="";for(const t of this.comments){const r=document.createElement("div");r.setAttribute("data-prototype-comment",t.id),r.title=t.text,r.style.position="absolute",r.style.transform="translate(-50%, -50%)",r.style.left=`${t.x}px`,r.style.top=`${t.y}px`,r.style.width="10px",r.style.height="10px",r.style.borderRadius="50%",r.style.background="#ff3b30",r.style.boxShadow="0 0 0 2px white",r.style.pointerEvents="none",e.appendChild(r)}}toJson(e){return e.map(t=>({id:t.id,text:t.text,x:t.x,y:t.y,timestamp:t.timestamp}))}toMarkdown(e){if(e.length===0)return"";const t=["# Comments",""];for(const r of e){const o=new Date(r.timestamp).toISOString();t.push(`- (${r.x}, ${r.y}) ${this.escapeMarkdown(r.text)} â€” ${o}`)}return t.join(`
`)}escapeMarkdown(e){return e.replace(/[\\`*_{}\[\]()#+\-.!|]/g,t=>`\\${t}`)}}const c=new u;function p(n){c.enable(n)}const d=c;p({storage:"memory",exportFormat:"json"});d.addComment({text:"Hello world",x:120,y:160});d.addComment({text:"Nice prototype!",x:280,y:220});
